{"version":3,"file":"dumper.js","sourceRoot":"","sources":["../../src/utils/dumper.ts"],"names":[],"mappings":";;;;;;;;;;;;AAAA,+CAA4C;AAC5C,mDAAkD;AAElD,MAAM,WAAW,GAAG;;;;upGAImoG,CAAC;AAqBxpG,MAAa,MAAM;IAKjB,YAAsB,UAAwC,EAAE;QAA1C,YAAO,GAAP,OAAO,CAAmC;QAC9D,IAAI,CAAC,CAAC,OAAO,CAAC,QAAQ,YAAY,mBAAQ,CAAC,EAAE;YAC3C,MAAM,IAAI,KAAK,CAAC,sCAAsC,CAAC,CAAC;SACzD;QACD,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAQ,CAAC;QACjC,IAAI,CAAC,SAAS,GAAG;YACf,cAAc,EAAE,EAAC,cAAc,EAAE,EAAE,EAAE,eAAe,EAAC,EAAE,EAAC;SACzD,CAAC;IACJ,CAAC;IAED;;;OAGG;IACI,OAAO;QACZ,OAAO,EAAE;aACN,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC;aACjB,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC;aAChB,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;aACrB,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;IAC3B,CAAC;IAED;;;;;;OAMG;IACU,sBAAsB,CAAC,GAAW,EAAE,OAAoB,EAAE,OAAoB;;YACzF,IAAI,CAAC,GAAG;gBAAE,MAAM,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC;YAC1C,MAAM,CAAC,UAAU,EAAE,QAAQ,CAAC,GAAG,GAAG,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;YAC9C,MAAM,OAAO,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;YACjC,MAAM,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;YACtC,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,CAAC,GAAG,CAAC,GAAG,EAAE,CAAC;QAC3C,CAAC;KAAA;IAEO,IAAI,CAAC,IAAY,EAAE,KAAU;QACnC,OAAO,EAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,EAAC,CAAC;IACjC,CAAC;IAED;;;OAGG;IACH,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,IAAI,CAAC,uBAAW,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;IACpD,CAAC;IAED;;OAEG;IACH,IAAI,QAAQ;QACV,OAAO,IAAI,CAAC,IAAI,CAAC,uBAAW,CAAC,QAAQ,CAAC,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;IAC9E,CAAC;IAED;;OAEG;IACH,IAAI,IAAI;QACN,MAAM,KAAK,GAAG,IAAI,CAAC,QAAQ,CAAC,QAAQ,EAAE,CAAC;QACvC,OAAO,IAAI,CAAC,IAAI,CAAC,uBAAW,CAAC,YAAY,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC;IACzD,CAAC;IAED;;OAEG;IACH,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,IAAI,CAAC,uBAAW,CAAC,WAAW,CAAC,IAAI,EAAE,WAAW,CAAC,CAAC;IAC9D,CAAC;CACF;AA3ED,wBA2EC","sourcesContent":["import { Workbook } from '../core/workbook';\nimport { PACKAGE_MAP } from '../common/constants';\n\nconst XMLContents = `<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?><xmap-content xmlns=\"urn:xmind:xmap:xmlns:content:2.0\" xmlns:fo=\"http://www.w3.org/1999/XSL/Format\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" modified-by=\"bruce\" timestamp=\"1503058545540\" version=\"2.0\"><sheet id=\"7abtd0ssc7n4pi1nu6i7b6lsdh\" modified-by=\"bruce\" theme=\"0kdeemiijde6nuk97e4t0vpp54\" timestamp=\"1503058545540\"><topic id=\"1vr0lcte2og4t2sopiogvdmifc\" modified-by=\"bruce\" structure-class=\"org.xmind.ui.logic.right\" timestamp=\"1503058545417\"><title>Warning\n警告\nAttention\nWarnung\n경고</title><children><topics type=\"attached\"><topic id=\"71h1aip2t1o8vvm0a41nausaar\" modified-by=\"bruce\" timestamp=\"1503058545423\"><title svg:width=\"500\">This file can not be opened normally, please do not modify and save, otherwise the contents will be permanently lost！</title><children><topics type=\"attached\"><topic id=\"428akmkh9a0tog6c91qj995qdl\" modified-by=\"bruce\" timestamp=\"1503058545427\"><title>You can try using XMind 8 Update 3 or later version to open</title></topic></topics></children></topic><topic id=\"2kb87f8m38b3hnfhp450c7q35e\" modified-by=\"bruce\" timestamp=\"1503058545434\"><title svg:width=\"500\">该文件无法正常打开，请勿修改并保存，否则文件内容将会永久性丢失！</title><children><topics type=\"attached\"><topic id=\"3m9hoo4a09n53ofl6fohdun99f\" modified-by=\"bruce\" timestamp=\"1503058545438\"><title>你可以尝试使用 XMind 8 Update 3 或更新版本打开</title></topic></topics></children></topic><topic id=\"7r3r4617hvh931ot9obi595r8f\" modified-by=\"bruce\" timestamp=\"1503058545444\"><title svg:width=\"500\">該文件無法正常打開，請勿修改並保存，否則文件內容將會永久性丟失！</title><children><topics type=\"attached\"><topic id=\"691pgka6gmgpgkacaa0h3f1hjb\" modified-by=\"bruce\" timestamp=\"1503058545448\"><title>你可以嘗試使用 XMind 8 Update 3 或更新版本打開</title></topic></topics></children></topic><topic id=\"0f2e3rpkfahg4spg4nda946r0b\" modified-by=\"bruce\" timestamp=\"1503058545453\"><title svg:width=\"500\">この文書は正常に開かないので、修正して保存しないようにしてください。そうでないと、書類の内容が永久に失われます。！</title><children><topics type=\"attached\"><topic id=\"4vuubta53ksc1falk46mevge0t\" modified-by=\"bruce\" timestamp=\"1503058545457\"><title>XMind 8 Update 3 や更新版を使って開くこともできます</title></topic></topics></children></topic><topic id=\"70n9i4u3lb89sq9l1m1bs255j5\" modified-by=\"bruce\" timestamp=\"1503058545463\"><title svg:width=\"500\">Datei kann nicht richtig geöffnet werden. Bitte ändern Sie diese Datei nicht und speichern Sie sie, sonst wird die Datei endgültig gelöscht werden.</title><children><topics type=\"attached\"><topic id=\"1qpc5ee298p2sqeqbinpca46b7\" modified-by=\"bruce\" timestamp=\"1503058545466\"><title svg:width=\"500\">Bitte versuchen Sie, diese Datei mit XMind 8 Update 3 oder später zu öffnen.</title></topic></topics></children></topic><topic id=\"4dmes10uc19pq7enu8sc4bmvif\" modified-by=\"bruce\" timestamp=\"1503058545473\"><title svg:width=\"500\">Ce fichier ne peut pas ouvert normalement, veuillez le rédiger et sauvegarder, sinon le fichier sera perdu en permanence. </title><children><topics type=\"attached\"><topic id=\"5f0rivgubii2launodiln7sdkt\" modified-by=\"bruce\" timestamp=\"1503058545476\"><title svg:width=\"500\">Vous pouvez essayer d'ouvrir avec XMind 8 Update 3 ou avec une version plus récente.</title></topic></topics></children></topic><topic id=\"10pn1os1sgfsnqa8akabom5pej\" modified-by=\"bruce\" timestamp=\"1503058545481\"><title svg:width=\"500\">파일을 정상적으로 열 수 없으며, 수정 및 저장하지 마십시오. 그렇지 않으면 파일의 내용이 영구적으로 손실됩니다!</title><children><topics type=\"attached\"><topic id=\"0l2nr0fq3em22rctapkj46ue58\" modified-by=\"bruce\" timestamp=\"1503058545484\"><title svg:width=\"500\">XMind 8 Update 3 또는 이후 버전을 사용하여</title></topic></topics></children></topic></topics></children><extensions><extension provider=\"org.xmind.ui.map.unbalanced\"><content><right-number>-1</right-number></content></extension></extensions></topic><title>Sheet 1</title></sheet></xmap-content>`;\n\nexport interface DumperOptions {\n  workbook: Workbook;\n}\n\ntype FileContent = ArrayBuffer | File | Blob;\n\nexport interface FileCreator {\n  /**\n   * hint that should enter a folder-like structure, create one if not exists\n   * @param name Folder name\n   */\n  folder(name: string): Promise<void>\n  /**\n   * hint that a file-like object should be created with the `content`, overrides if exists\n   * @param name Filename\n   */\n  file(name: string, content: FileContent): Promise<void>\n}\n\nexport class Dumper {\n  private workbook: Workbook;\n\n  private _manifest: Record<string, unknown>;\n\n  constructor(protected options: DumperOptions = <DumperOptions>{}) {\n    if (!(options.workbook instanceof Workbook)) {\n      throw new Error('The instance of workbook is required');\n    }\n    this.workbook = options.workbook;\n    this._manifest = {\n      'file-entries': {'content.json': {}, 'metadata.json':{}}\n    };\n  }\n\n  /**\n   * @description dumping an object that contains the pair of $filename: $value\n   * @return {Array} Array<{filename: string, value: any}>\n   */\n  public dumping() {\n    return []\n      .concat(this.json)\n      .concat(this.xml)\n      .concat(this.manifest)\n      .concat(this.metadata);\n  }\n\n  /**\n   * @description Update manifest metadata\n   * @param { string } key - a string key\n   * @param { FileContent } content - file content\n   * @param { FileCreator } creator - specify how to save the file\n   * @return { Promise<void> } a promise that follows the promise returned by the method of `creator`, or rejects if the key is empty\n   */\n  public async updateManifestMetadata(key: string, content: FileContent, creator: FileCreator) {\n    if (!key) throw new Error('key is empty');\n    const [folderName, fileName] = key.split('/');\n    await creator.folder(folderName);\n    await creator.file(fileName, content);\n    this._manifest['file-entries'][key] = {};\n  }\n\n  private wrap(name: string, value: any) {\n    return {filename: name, value};\n  }\n\n  /**\n   * @description metadata.json\n   *\n   */\n  get metadata() {\n    return this.wrap(PACKAGE_MAP.METADATA.NAME, '{}');\n  }\n\n  /**\n   * @description manifest.json\n   */\n  get manifest() {\n    return this.wrap(PACKAGE_MAP.MANIFEST.NAME, JSON.stringify(this._manifest));\n  }\n\n  /**\n   * @description content.json\n   */\n  get json() {\n    const value = this.workbook.toString();\n    return this.wrap(PACKAGE_MAP.CONTENT_JSON.NAME, value);\n  }\n\n  /**\n   * @description content.xml\n   */\n  get xml() {\n    return this.wrap(PACKAGE_MAP.CONTENT_XML.NAME, XMLContents);\n  }\n}\n\n"]}